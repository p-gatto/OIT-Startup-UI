<div class="sidebar-container">

    <div class="sidebar-header">
        <h3>Menu Navigazione</h3>
    </div>

    <div class="sidebar-content">
        @if (loading()) {
        <div class="loading-container">
            <p>Caricamento menu...</p>
        </div>
        } @else {
        @for (menuItem of menu(); track menuItem.id) {
        <div class="menu-section">
            <!-- Gruppo principale come tendina -->
            <div class="section-header" (click)="toggleSection(menuItem.title)">
                <div class="section-title">{{ menuItem.title || 'Menu' }}</div>
                <mat-icon class="section-expand-icon" [class.expanded]="isSectionExpanded(menuItem.title)">
                    expand_more
                </mat-icon>
            </div>

            <!-- Contenuto del gruppo (collassabile) -->
            <div class="section-content" [class.expanded]="isSectionExpanded(menuItem.title)">
                <mat-nav-list class="section-list">
                    @for (item of menuItem.items || []; track item.id) {
                    <div class="menu-item-container">
                        <!-- Item senza figli -->
                        @if (!item.children || item.children.length === 0) {
                        <mat-list-item (click)="navigateTo(item.route || '/', item.queryParams || {})"
                            class="menu-item">
                            <mat-icon matListItemIcon>{{ item.icon || 'menu' }}</mat-icon>
                            <span matListItemTitle>{{ item.title || 'Menu Item' }}</span>
                        </mat-list-item>
                        }
                        <!-- Item con figli (2Â° livello) -->
                        @if (item.children && item.children.length > 0) {
                        <div class="menu-group">
                            <div class="parent-item" (click)="toggleGroup(item.title)">
                                <mat-icon class="parent-icon">{{ item.icon || 'folder' }}</mat-icon>
                                <span class="parent-title">{{ item.title || 'Menu Group' }}</span>
                                <mat-icon class="expand-icon" [class.expanded]="isGroupExpanded(item.title)">
                                    expand_more
                                </mat-icon>
                            </div>

                            <div class="children-container" [class.expanded]="isGroupExpanded(item.title)">
                                @for (child of item.children; track child.id) {
                                <mat-list-item (click)="navigateTo(child.route || '/', child.queryParams || {})"
                                    class="child-item">
                                    <mat-icon matListItemIcon>{{ child.icon || 'menu' }}</mat-icon>
                                    <span matListItemTitle>{{ child.title || 'Child Item' }}</span>
                                </mat-list-item>
                                }
                            </div>
                        </div>
                        }
                    </div>
                    }
                </mat-nav-list>
            </div>

            @if (isSectionExpanded(menuItem.title) && !isLastSection(menuItem)) {
            <mat-divider class="section-divider"></mat-divider>
            }
        </div>
        }
        }

        @if (menu().length === 0 && !loading()) {
        <div class="empty-menu">
            <p>Nessun menu disponibile</p>
        </div>
        }
    </div>

</div>